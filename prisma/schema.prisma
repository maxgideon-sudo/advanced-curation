// Advanced Curation Deal Desk Database Schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String?  // Only set when they convert from Lead to Client
  name      String?
  company   String?  // Brand or Agency name
  role      Role     @default(LEAD)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  deals Deal[]

  @@map("users")
}

model Deal {
  id          String   @id @default(cuid())
  dealId      String   @unique // Generated Deal ID for DSP
  email       String?  // For leads who haven't created account yet
  company     String   // Brand or Agency
  dsp         String   // Demand Side Platform
  seatId      String   // DSP Seat ID
  flightStart DateTime?
  flightEnd   DateTime?
  alwaysOn    Boolean  @default(false)
  mediaType   MediaType
  geoTargeting Json?   // Flexible geo targeting data
  idealInventory String @db.Text // Open text field for OpenAI analysis
  aiAnalysis  String?  @db.Text // Result from OpenAI analysis
  status      DealStatus @default(ACTIVE)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  userId String?
  user   User?  @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Media-specific data
  ctvApps     CtvApp[]
  domains     Domain[]
  inAppList   InAppItem[]
  
  @@map("deals")
}

model DSP {
  id   String @id @default(cuid())
  name String @unique
  code String @unique // Short code for the DSP
  
  @@map("dsps")
}

model SeatId {
  id    String @id @default(cuid())
  seatId String @unique
  dspId String
  name  String? // Optional name/description
  
  @@map("seat_ids")
}

model CtvApp {
  id       String @id @default(cuid())
  name     String
  bundleId String @unique
  dealId   String
  deal     Deal   @relation(fields: [dealId], references: [id], onDelete: Cascade)
  
  @@map("ctv_apps")
}

model Domain {
  id     String @id @default(cuid())
  domain String
  dealId String
  deal   Deal   @relation(fields: [dealId], references: [id], onDelete: Cascade)
  
  @@map("domains")
}

model InAppItem {
  id       String @id @default(cuid())
  appName  String
  bundleId String
  dealId   String
  deal     Deal   @relation(fields: [dealId], references: [id], onDelete: Cascade)
  
  @@map("in_app_items")
}

// Geo targeting reference data
model State {
  id   String @id @default(cuid())
  name String @unique
  code String @unique // State abbreviation
  
  @@map("states")
}

model DMA {
  id   String @id @default(cuid())
  name String @unique
  code String @unique
  
  @@map("dmas")
}

model City {
  id      String @id @default(cuid())
  name    String
  state   String
  stateCode String
  
  @@map("cities")
}

model ZipCode {
  id   String @id @default(cuid())
  zip  String @unique
  city String
  state String
  
  @@map("zip_codes")
}

enum Role {
  LEAD
  CLIENT
  ADMIN
}

enum MediaType {
  CTV
  OLV
  DISPLAY
  IN_APP
}

enum DealStatus {
  ACTIVE
  PAUSED
  EXPIRED
  DRAFT
}
